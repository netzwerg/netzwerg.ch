<html>
<head>

    <title>Above, Below, and Beyond Tech Talk</title>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon" />

    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/tomorrow-night-bright.css" />

    <link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />

    <link href="/css/style.css" rel="stylesheet" />
</head>
<body>
<div class="container header">
    <div class="jumbotron">
        <h1>Above, Below, and Beyond Tech Talk</h1>
        <p>by Rahel L√ºthy</p>
    </div>
    <nav class="navbar navbar-default">
        <div>
            <ul class="nav navbar-nav">
                <li><a href="/">Blog</a></li>
                <li><a href="/archive.html">Archive</a></li>
                <li><a href="/about.html">About</a></li>
            </ul>
        </div>
    </nav>
</div>
<div class="container content">
    
<div class="info">
    October 24, 2019
</div>
<h1>A CSS Subgrid Example</h1>
<p>Whenever I hear about a new technology or language feature, the first question I ask myself is: <strong>Which problem does it solve?</strong> So when I learned about the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout/Subgrid">addition of subgrid to the CSS Grid Layout specification</a>, I wanted to see a simple example which showed a subgrid-based solution to an actual problem. I found <a href="https://www.youtube.com/watch?v=gmQlK3kRft4">helpful videos</a> and <a href="https://rachelandrew.co.uk/archives/2019/04/16/css-subgrid-news-and-demos">rock-solid-but-complicated layout arrangements</a>, but nothing simple.</p>
<p>This post is the 3‚Äô-intro I was looking for:</p>
<h2 id="a-simple-form">A Simple Form</h2>
<p>Suppose you are dealing with the following HTML form:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">&lt;form&gt;</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;name&quot;</span><span class="ot"> class=</span><span class="st">&quot;field&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">&quot;label-text&quot;</span><span class="kw">&gt;</span>Name<span class="kw">&lt;/span&gt;</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> id=</span><span class="st">&quot;name&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="kw">&lt;/label&gt;</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;email&quot;</span><span class="ot"> class=</span><span class="st">&quot;field&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">&quot;label-text&quot;</span><span class="kw">&gt;</span>Email<span class="kw">&lt;/span&gt;</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;email&quot;</span><span class="ot"> id=</span><span class="st">&quot;email&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb1-9" title="9">  <span class="kw">&lt;/label&gt;</span></a>
<a class="sourceLine" id="cb1-10" title="10">  <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;message&quot;</span><span class="ot"> class=</span><span class="st">&quot;field&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">&quot;label-text&quot;</span><span class="kw">&gt;</span>A Looong Label<span class="kw">&lt;/span&gt;</span></a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> id=</span><span class="st">&quot;message&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb1-13" title="13">  <span class="kw">&lt;/label&gt;</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="kw">&lt;/form&gt;</span></a></code></pre></div>
<p>The existing CSS Grid layout already makes it easy to arrange individual fields:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">.field</span> {</a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="kw">display</span>: grid<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="kw">grid-template-columns</span>: <span class="bu">auto</span> <span class="dv">1</span>fr<span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw">grid-column-gap</span>: <span class="dv">1</span><span class="dt">em</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="kw">margin-bottom</span>: <span class="dv">1</span><span class="dt">em</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-6" title="6">}</a></code></pre></div>
<p>As a result, each row dynamically respects the preferred width of its label:</p>
<p><img src="/images/form-css-grid.png" /></p>
<p>While this is a good start, we would like to have something better:</p>
<p>A two-column definition, so that</p>
<ul>
<li>the widest label determines the width of the left column</li>
<li>all input fields are aligned in the right column</li>
</ul>
<p><img src="/images/form-css-subgrid.png" /></p>
<p>This is exactly what the new <strong>subgrid</strong> feature is for: It matches up its grid lines to lines in the parent grid. We move the two-column grid layout definition to the parent form, and tell the fields to align along these tracks:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb3-1" title="1">form {</a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="kw">display</span>: grid<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="kw">grid-template-columns</span>: <span class="bu">auto</span> <span class="dv">1</span>fr<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="kw">grid-column-gap</span>: <span class="dv">1</span><span class="dt">em</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5">}</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="fu">.field</span> {</a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="kw">display</span>: grid<span class="op">;</span></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="kw">grid-column</span>: span <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="kw">grid-template-columns</span>: subgrid<span class="op">;</span></a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="kw">margin-bottom</span>: <span class="dv">1</span><span class="dt">em</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-12" title="12">}</a></code></pre></div>
<p><em>Caution: CSS Subgrid is <a href="https://caniuse.com/#feat=css-subgrid">only supported in Firefox (v71)</a></em></p>

<hr />

<div class="info">
    November 21, 2018
</div>
<h1>How we use React/Redux with TypeScript</h1>
<p>Our team develops visual applications in the field of medical informatics. We started using React/Redux with TypeScript a few months ago. This post is a highly opinionated summary of best practices that evolved over time:</p>
<ul>
<li><a href="#1">Favor Types Over Classes</a></li>
<li><a href="#2">Don‚Äôt Fear Stringly Types</a></li>
<li><a href="#3">Favor Composition Over Inheritance</a></li>
<li><a href="#4">Immutability FTW</a></li>
<li><a href="#5">Nominal Typing</a></li>
<li><a href="#6">Explicit Types Enhance Readability</a></li>
<li><a href="#7">TSS: CSS + TypeScript = üòç</a></li>
<li><a href="#8">Look Ma, No Semicolons!</a></li>
</ul>
<p>A bit of personal background, to give certain decisions more context: I have been developing user interfaces for over 20 years. Java and OOP have been loyal companions throughout most of this time. A few years ago, I started doing more and more FP, mostly in Scala &amp; Elm, but also in Java (hi <a href="http://www.vavr.io">vavr</a> üëã).</p>
<p>Our team members come from all sorts of backgrounds. When deciding on a web app stack, opinions varied a lot. We finally settled on React/Redux + TypeScript as a compromise ‚Äì it turned out to be a good decision.</p>
<h2 id="favor-types-over-classes"><a name="1"></a>Favor Types Over Classes</h2>
<p>Coming from an OOP background, it was comforting that TypeScript brings familiar OOP constructs to the table. However, TypeScript is based on a structural type system, which can confuse Java developers very quickly:</p>
<pre class="typescript"><code>class Patient {

    firstName: string
    lastName: string

    constructor(firstName: string, lastName: string) {
        this.firstName = firstName
        this.lastName = lastName
    }
}

const patient: Patient = { firstName: 'Ada', lastName: 'Lovelace' }

console.log(patient instanceof Patient) // false ‚Äì seriously?! ü§î</code></pre>
<p>I am sure that one could get used to the TypeScript way of working with classes. However, we somehow ended up not using classes at all ü§∑. Instead, we exclusively model our data with read-only types:</p>
<pre class="typescript"><code>type Patient = Readonly&lt;{
    id: PatientId
    caseId: CaseId
    bed: BedId
    firstName: string
    lastName: string
}&gt;</code></pre>
<p>Super concise and very safe to use.</p>
<h2 id="dont-fear-stringly-types"><a name="2"></a>Don‚Äôt Fear Stringly Types</h2>
<p>Any experienced Java programmer avoids stringly types like the plague. In Java, this makes sense, they prevent the compiler from helping us find errors. The TypeScript compiler works differently, so be ready to embrace patterns which you would avoid in Java:</p>
<pre class="typescript"><code>type Patient = Readonly&lt;{
    gender: 'male' | 'female' | 'non-binary'
}&gt;</code></pre>
<p>Code completion works perfectly fine here:</p>
<p><img src="/images/typescript-code-completion.png" /></p>
<p>And the compiler detects errors flawlessly:</p>
<pre class="typescript"><code>const smartStringHandling = (patient: Patient) =&gt; {
    if (patient.gender === 'whatever') { // compile error
        
    }
}</code></pre>
<p>To give a more advanced example, here‚Äôs how we base our action types, actions, and reducers on simple strings:</p>
<p><em>actionTypes.ts</em></p>
<pre class="typescript"><code>const ADD_MESSAGE = 'message/add'
const ADD_TODO = 'todo/add'</code></pre>
<p><em>actions.ts</em></p>
<pre class="typescript"><code>type Action = AddMessageAction | AddTodoAction

type AddMessageAction = Readonly&lt;{
    type: typeof ADD_MESSAGE
    message: Message
}&gt;

type AddTodoAction = Readonly&lt;{
    type: typeof ADD_TODO
    todo: Todo
}&gt;</code></pre>
<p><em>reducer.ts</em></p>
<pre class="typescript"><code>const reducer = (state: State, action: Action): State =&gt; {
    switch (action.type) {
        case ADD_MESSAGE:

            // üéâ this would require a cast in Java
            const message = action.message

            return {
                ...state,
                messages: state.messages.push(message)
            }
        case ADD_TODO:
            return {
                ...state,
                todos: state.todos.push(action.todo)
            }
    }
}</code></pre>
<h2 id="favor-composition-over-inheritance"><a name="3"></a>Favor Composition Over Inheritance</h2>
<p>As mentioned above, we don‚Äôt really use TypeScript‚Äôs OOP features, so using inheritance has never been very tempting. Instead, we often use a mix of composition, union types, and intersection types to foster code re-use:</p>
<pre class="typescript"><code>type Patient = Readonly&lt;{
    address: Address // Composition
    gender: 'male' | 'female' | 'non-binary' // Union Type
}&gt;

type Displayable = Readonly&lt;{
    displayName: string
}&gt;

type DisplayablePatient = Patient &amp; Displayable // Intersection Type</code></pre>
<h2 id="immutability-ftw"><a name="4"></a>Immutability FTW</h2>
<p>We haven‚Äôt seen many runtime errors, but the ones that occurred were all caused by inconsistent mutations. That‚Äôs why we settled on using the <a href="https://facebook.github.io/immutable-js">immutable</a> collections library to make all our state completely read-only:</p>
<pre class="typescript"><code>import { Map } from 'immutable'

type State = Readonly&lt;{
    bedByPatient: Map&lt;PatientId, BedId&gt;
}&gt;</code></pre>
<h2 id="nominal-typing"><a name="5"></a>Nominal Typing</h2>
<p>Using type aliases for your identifiers seems very convenient. No need for extra wrapping, and very readable code:</p>
<pre class="typescript"><code>type PatientId = string
type BedId = string

type State = Readonly&lt;{
    bedByPatient: Map&lt;PatientId, BedId&gt;
}&gt;</code></pre>
<p>Unfortunately, things look more type-safe than they are. Aliases are nothing more than what their name implies: they are simple synonyms. Any <code>string</code> can be used in place of a <code>PatientId</code> or <code>BedId</code> ‚Äì and vice versa:</p>
<pre class="typescript"><code>
const state: State = {
    bedByPatient: Map&lt;PatientId, BedId&gt;()
}

// Compiles just fine, which is NOT what we want
state.bedByPatient.set('foo', 'bar')</code></pre>
<p>We want to have types which can be distinguished by the compiler because they have different names, even though they share the same structure (a <code>string</code>). This is known as ‚Äúnominal typing‚Äù. The <a href="https://basarat.gitbooks.io/typescript/docs/tips/nominalTyping.html">TypeScript Deep Dive Book</a> gives a good list of nominal typing patterns.</p>
<p>We are using the <code>enum</code>-based brand pattern to get the desired compile-time safety:</p>
<pre class="typescript"><code>enum PatientIdBrand {}
type PatientId = PatientIdBrand &amp; string

enum BedIdBrand {}
type BedId = BedIdBrand &amp; string

type State = Readonly&lt;{
    bedByPatient: Map&lt;PatientId, BedId&gt;
}&gt;

const state: State = {
    bedByPatient: Map()
}

// Compile error:
// Argument type '&quot;foo&quot;' is not assignable to parameter of type 'PatientId'
state.bedByPatient.set('foo', 'bar')</code></pre>
<h2 id="explicit-types-enhance-readability"><a name="6"></a>Explicit Types Enhance Readability</h2>
<p>While it is often possible to not specify types explicitly, they still sometimes enhance code readability (and IDE completion, for that matter). Container components are a good example: they involve a lot of ‚Äúplumbing‚Äù, where input/output types have to match, so explicit types are a plus here. This is how our container components tend to look:</p>
<pre class="typescript"><code>type Props = Readonly&lt;{
    patientId: PatientId
}&gt;

type FromStateProps = Readonly&lt;{
    patient: Patient
}&gt;

const mapStateToProps = (state: State, props: Props): FromStateProps =&gt; {
    const patient = getPatient(state, props.patientId)
    return {
        patient
    }
}

type FromDispatchProps = Readonly&lt;{
    onMouseEnter: () =&gt; void
    onMouseOut: () =&gt; void
}&gt;

const mapDispatchToProps = (dispatch: Dispatch&lt;PatientsAction&gt;, props: Props): FromDispatchProps =&gt; {
    return {
        onMouseEnter: () =&gt; dispatch(selectPatients(ImmutableList.of(props.patientId))),
        onMouseOut: () =&gt; dispatch(selectPatients(ImmutableList()))
    }
}

export default connect(mapStateToProps, mapDispatchToProps)(ExampleComponent)</code></pre>
<h2 id="tss-css-typescript"><a name="7"></a>TSS: CSS + TypeScript = üòç</h2>
<p>As a developer, CSS has always been the scary corner of my applications. It uses a global namespace, you cannot use variables, and it‚Äôs almost impossible to tell which code is even in use at all. So you end up treating your CSS very differently from the rest of your code: no refactorings, no re-use, no clean-up.</p>
<p>We are using <a href="https://material-ui.com">Material-UI</a> in all our projects, so it did not take much convincing to also use their styling solution. It uses JSS at its core and has excellent TypeScript support. This is how a basic component looks:</p>
<pre class="typescript"><code>import { createStyles, withStyles, WithStyles } from '@material-ui/core'
import * as React from 'react'

const styles = createStyles({
    root: {
        backgroundColor: 'steelblue'
    }
})

type Props = Readonly&lt;{
    text: string
}&gt; &amp; WithStyles&lt;typeof styles&gt;

const ExampleComponent = ({ text, classes }: Props) =&gt;
    &lt;div className={classes.root}&gt;{text}&lt;/div&gt;

export default withStyles(styles)(ExampleComponent)</code></pre>
<h2 id="look-ma-no-semicolons"><a name="8"></a>Look Ma, No Semicolons!</h2>
<p>And finally, a good practice that is not specific to React nor TypeScript: make your code <a href="https://prettier.io">prettier</a>! We use <a href="https://github.com/typicode/husky">husky</a> to kick off code formatting before each git commit. Here‚Äôs our current configuration:</p>
<p><em>.prettierrc:</em></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb15-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="dt">&quot;tabWidth&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="dt">&quot;useTabs&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="dt">&quot;semi&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="dt">&quot;singleQuote&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="dt">&quot;printWidth&quot;</span><span class="fu">:</span> <span class="dv">120</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="fu">}</span></a></code></pre></div>
<p><em>Thanks for reviewing this post, <a href="https://twitter.com/ben_rosenbaum">Ben</a>!</em></p>

<hr />

<div class="info">
    May 24, 2018
</div>
<h1>React SVG Tooltips</h1>
<p>SVG has built-in support for tooltips through its <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/title"><code>&lt;title&gt;</code></a> element. However, the rendered text looks very basic and cannot easily by styled:</p>
<p><img src="/images/svg-built-in-tooltip.png" /></p>
<p>Tooltips are an important design element when creating information-heavy, visual applications. They allow keeping the user interface clean, providing information only when needed. As <a href="https://www.cs.umd.edu/~ben/papers/Shneiderman1996eyes.pdf">Shneiderman (1996)</a> put it in his famous <strong>visual information-seeking mantra</strong>:<br />
<br />
Overview first, zoom and filter, then details-on-demand<br />
Overview first, zoom and filter, then details-on-demand<br />
Overview first, zoom and filter, then details-on-demand<br />
<br />
Tooltips cover the <strong>details-on-demand</strong> aspect. However, in order to provide such details in an appealing way, built-in SVG tooltips are often not sufficient.</p>
<h2 id="svg-tooltips">SVG Tooltips</h2>
<p>There‚Äôs actually a pretty good technology out there to design appealing graphical UI elements: SVG! It is way superior to simple text boxes.</p>
<p>In an ideal SVG world, tooltips would:</p>
<ol type="1">
<li>Be specific to an element<br />
</li>
<li>Be visible on demand (mouse hovering)<br />
</li>
<li>Support fully customizable SVG contents<br />
</li>
<li>Appear always on top</li>
</ol>
<p><strong>Good News</strong>: If you‚Äôre using React, I have got you covered! Meet <a href="https://www.npmjs.com/package/react-svg-tooltip">react-svg-tooltip</a>, my npm package that addresses all SVG tooltip needs.</p>
<h2 id="intro-to-react-svg-tooltip">Intro to react-svg-tooltip</h2>
<p>The library offers a <code>Tooltip</code> component which can be embedded in any SVG element hierarchy:</p>
<pre class="jsx"><code>import * as React from 'react';
import { Tooltip } from 'react-svg-tooltip';

const App = () =&gt; {

    const circleRef = React.createRef&lt;SVGCircleElement&gt;();

    return (
        &lt;div className='App'&gt;
            &lt;svg viewBox='0 0 100 100'&gt;
                &lt;circle ref={circleRef} cx={50} cy={50} r={10} fill='steelblue'/&gt;
                &lt;Tooltip for={circleRef}&gt;
                    &lt;rect x={2} y={2} width={10} height={5} rx={.5} ry={.5} fill='black'/&gt;
                    &lt;text x={5} y={5} fontSize={2} fill='white'&gt;Yay!&lt;/text&gt;
                &lt;/Tooltip&gt;
            &lt;/svg&gt;
        &lt;/div&gt;
    );
};

export default App;</code></pre>
<p><a href="https://codesandbox.io/s/pk7p4y9v3q"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit pk7p4y9v3q" /></a></p>
<p><img src="/images/react-svg-tooltip.png" /></p>
<p>The component covers all requirements listed above:</p>
<ol type="1">
<li>Its <code>for</code> property accepts a reference to an element which serves as the mouse trigger<br />
</li>
<li>All mouse listener handling is happening behind the scenes<br />
</li>
<li>Arbitrary SVG can be used as tooltip contents. In fact, the library itself does not provide an actual tooltip. Instead, it gives you a 0-based coordinate system, so you can place your favorite SVG elements in whichever style suits your needs.<br />
</li>
<li>Contents are attached to the root <code>svg</code> element (using a <a href="https://reactjs.org/docs/portals.html">React portal</a> behind the scenes). Thereby your tooltip will always be rendered last, i.e.¬†always on top.</li>
</ol>
<p>As usual, all <a href="https://github.com/netzwerg/react-svg-tooltip">code is on GitHub</a>, feedback is very welcome, and PRs are highly appreciated!</p>

<hr />

<a class="index-footer" href="/archive.html">Older Posts &raquo; Archive</a>

</div>
<div class="container footer">
    <p>Written by Rahel L√ºthy &mdash; Generated by <a href="https://jaspervdj.be/hakyll">Hakyll</a></p>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>