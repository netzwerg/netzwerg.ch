<html>
<head>

    <title>Above, Below, and Beyond Tech Talk</title>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon" />

    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/tomorrow-night-bright.css" />

    <link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />

    <link href="/css/style.css" rel="stylesheet" />
</head>
<body>
<div class="container header">
    <div class="jumbotron">
        <h1>Above, Below, and Beyond Tech Talk</h1>
        <p>by Rahel Lüthy</p>
    </div>
    <nav class="navbar navbar-default">
        <div>
            <ul class="nav navbar-nav">
                <li><a href="/">Blog</a></li>
                <li><a href="/archive.html">Archive</a></li>
                <li><a href="/about.html">About</a></li>
            </ul>
        </div>
    </nav>
</div>
<div class="container content">
    
<div class="info">
    May 24, 2018
</div>
<h1>React SVG Tooltips</h1>
<p>SVG has built-in support for tooltips through its <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/title"><code>&lt;title&gt;</code></a> element. However, the rendered text looks very basic and cannot easily by styled:</p>
<p><img src="/images/svg-built-in-tooltip.png" /></p>
<p>Tooltips are an important design element when creating information-heavy, visual applications. They allow keeping the user interface clean, providing information only when needed. As <a href="https://www.cs.umd.edu/~ben/papers/Shneiderman1996eyes.pdf">Shneiderman (1996)</a> put it in his famous <strong>visual information-seeking mantra</strong>:<br />
<br />
Overview first, zoom and filter, then details-on-demand<br />
Overview first, zoom and filter, then details-on-demand<br />
Overview first, zoom and filter, then details-on-demand<br />
<br />
Tooltips cover the <strong>details-on-demand</strong> aspect. However, in order to provide such details in an appealing way, built-in SVG tooltips are often not sufficient.</p>
<h2 id="svg-tooltips">SVG Tooltips</h2>
<p>There’s actually a pretty good technology out there to design appealing graphical UI elements: SVG! It is way superior to simple text boxes.</p>
<p>In an ideal SVG world, tooltips would:</p>
<ol type="1">
<li>Be specific to an element<br />
</li>
<li>Be visible on demand (mouse hovering)<br />
</li>
<li>Support fully customizable SVG contents<br />
</li>
<li>Appear always on top</li>
</ol>
<p><strong>Good News</strong>: If you’re using React, I have got you covered! Meet <a href="https://www.npmjs.com/package/react-svg-tooltip">react-svg-tooltip</a>, my npm package that addresses all SVG tooltip needs.</p>
<h2 id="intro-to-react-svg-tooltip">Intro to react-svg-tooltip</h2>
<p>The library offers a <code>Tooltip</code> component which can be embedded in any SVG element hierarchy:</p>
<pre class="jsx"><code>import * as React from 'react';
import { Tooltip } from 'react-svg-tooltip';

const App = () =&gt; {

    const circleRef = React.createRef&lt;SVGCircleElement&gt;();

    return (
        &lt;div className='App'&gt;
            &lt;svg viewBox='0 0 100 100'&gt;
                &lt;circle ref={circleRef} cx={50} cy={50} r={10} fill='steelblue'/&gt;
                &lt;Tooltip for={circleRef}&gt;
                    &lt;rect x={2} y={2} width={10} height={5} rx={.5} ry={.5} fill='black'/&gt;
                    &lt;text x={5} y={5} fontSize={2} fill='white'&gt;Yay!&lt;/text&gt;
                &lt;/Tooltip&gt;
            &lt;/svg&gt;
        &lt;/div&gt;
    );
};

export default App;</code></pre>
<p><a href="https://codesandbox.io/s/pk7p4y9v3q"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit pk7p4y9v3q" /></a></p>
<p><img src="/images/react-svg-tooltip.png" /></p>
<p>The component covers all requirements listed above:</p>
<ol type="1">
<li>Its <code>for</code> property accepts a reference to an element which serves as the mouse trigger<br />
</li>
<li>All mouse listener handling is happening behind the scenes<br />
</li>
<li>Arbitrary SVG can be used as tooltip contents. In fact, the library itself does not provide an actual tooltip. Instead, it gives you a 0-based coordinate system, so you can place your favorite SVG elements in whichever style suits your needs.<br />
</li>
<li>Contents are attached to the root <code>svg</code> element (using a <a href="https://reactjs.org/docs/portals.html">React portal</a> behind the scenes). Thereby your tooltip will always be rendered last, i.e. always on top.</li>
</ol>
<p>As usual, all <a href="https://github.com/netzwerg/react-svg-tooltip">code is on GitHub</a>, feedback is very welcome, and PRs are highly appreciated!</p>

<hr />

<div class="info">
    May  3, 2018
</div>
<h1>GitHub Pages Custom Domains Via HTTPS</h1>
<p>Two days ago, GitHub <a href="https://blog.github.com/2018-05-01-github-pages-custom-domains-https/">announced</a> the support of HTTPS for custom domains. In addition to this blog, I maintain a few websites for <a href="https://physiomovimento.ch/">friends</a> and <a href="https://psychotherapie-bieri.ch/">family</a>, all configured through <code>A</code> records – time for migration!</p>
<p>Officially, the migration is a simple matter of toggling the “Enforce HTTPS” button, but the button was disabled for all of my sites. The explanation wasn’t particularly encouraging: <em>Unavailable for your site because your domain is not properly configured to support HTTPS</em>.</p>
<p>Well, time for RTFM (not my favorite hobby).</p>
<p>These are the steps that finally worked for me:</p>
<h2 id="https-migration-steps">HTTPS Migration Steps</h2>
<h3 id="step-0-mixed-content-prevention">Step 0: Mixed Content Prevention</h3>
<p>First things first: Prepare your site’s content. Ensure that all your assets (links to CSS, JS, etc.) are loaded via HTTPS. Otherwise browsers might block your “Mixed Content”.</p>
<h3 id="step-1-dns-a-record-migration">Step 1: DNS A-Record Migration</h3>
<p>On your provider’s website, change all <code>A</code> records to point to the following four new IPs:<br />
 </p>
<p><del><code>192.30.252.153</code></del></p>
<p><del><code>192.30.252.154</code></del></p>
<p><code>185.199.108.153</code></p>
<p><code>185.199.109.153</code></p>
<p><code>185.199.110.153</code></p>
<p><code>185.199.111.153</code><br />
 </p>
<p>This change might take a few hours to become effective (depending on the TTL). Use <code>dig</code> to check whether the new DNS configuration is ready:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">dig</span> netzwerg.ch +noall +answer</a></code></pre></div>
<p>It should look like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1">; <span class="op">&lt;&lt;&gt;&gt;</span> <span class="ex">DiG</span> 9.10.6 <span class="op">&lt;&lt;&gt;&gt;</span> netzwerg.ch +noall +answer</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">;; <span class="ex">global</span> options: +cmd</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="ex">netzwerg.ch.</span>		10800	IN	A	185.199.110.153</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="ex">netzwerg.ch.</span>		10800	IN	A	185.199.111.153</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="ex">netzwerg.ch.</span>		10800	IN	A	185.199.108.153</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="ex">netzwerg.ch.</span>		10800	IN	A	185.199.109.153</a></code></pre></div>
<h3 id="step-2-trigger-certificate-generation">Step 2: Trigger Certificate Generation</h3>
<p>In order for GitHub to detect that your site is now ready for migration, you apparently need to trigger a detection script. Any change to your repository’s <code>CNAME</code> file will do, so e.g. make a minor change and revert it, or make a harmless whitespace edit. As a result, GitHub will now generate the certificates necessary for HTTPS.</p>
<h3 id="step-3-wait-for-certificate-availability">Step 3: Wait For Certificate Availability</h3>
<p>Now the “Enforce HTTPS” button will still be disabled, but the explanation will be much more encouraging: <em>Not yet available for your site because the certificate has not finished being issued</em>. More patience required, we’re getting there…</p>
<h3 id="step-4-enforce-https">Step 4: Enforce HTTPS</h3>
<p>It might take a few hours, but as soon as this message is gone, you can access your site via HTTPS. Check that everything still works (particularly your new HTTPS asset links). Once you’re happy, toggle the “Enforce HTTPS” switch – Voilà!</p>

<hr />

<div class="info">
    April 24, 2018
</div>
<h1>Position animations across SVG groups</h1>
<p>Animated transitions between UI states can greatly enhance the usability of applications because they reduce the likelihood of <a href="https://en.wikipedia.org/wiki/Change_blindness">change blindness</a>.</p>
<p>In a typical web application, UI state is represented by the DOM. Instead of switching from one DOM state to the next instantaneously, animations smoothly transition DOM element properties over time.</p>
<p>On a technical level, a multitude of libraries provide abstractions to create animated transitions with minimal effort.</p>
This is how an animation of an SVG circle would look like with D3.js (notice the “Rerun” button which appears once you hover the right pane):<br />
 
<p data-height="265" data-theme-id="0" data-slug-hash="JvXobe" data-default-tab="js,result" data-user="netzwerg" data-embed-version="2" data-pen-title="D3.js Animation" class="codepen">
See the Pen <a href="https://codepen.io/netzwerg/pen/JvXobe/">D3.js Animation</a> by Rahel Lüthy (<a href="https://codepen.io/netzwerg"><span class="citation" data-cites="netzwerg">@netzwerg</span></a>) on <a href="https://codepen.io">CodePen</a>.
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>
<p><br />
 </p>
<p>D3.js is interpolating the circle’s <code>cx</code> attribute from <code>10</code> to <code>190</code> pixels over the course of a second.</p>
<p>Well, this is a simple example because the SVG scene graph is simple – it just contains one circle. Unfortunately, SVG scene graphs tend to get very complex in real applications. One way to tame this complexity, is by breaking applications into components, each responsible for rendering a sub-graph of the final SVG.</p>
<h2 id="components-ftw">Components FTW</h2>
<p>Component-based libraries like React come in handy here: Each component is responsible for rendering a small, human-digestible SVG chunk.</p>
<p>Here’s a React component which renders a box with a circle at its center:</p>
<p><img src="/images/box-static-circle.png" width="25%" style="padding: 20 0 20 0;" /></p>
<pre class="typescript"><code>const Box = ({width, height}: BoxProps) =&gt; {
    return (
        &lt;g&gt;
            &lt;rect width={width} height={height}/&gt;
            &lt;circle cx={width / 2} cy={height / 2}/&gt;
        &lt;/g&gt;
    );
};</code></pre>
<p>Using simple composition, we can then stack two boxes on top of each other:</p>
<p><img src="/images/boxes-static-circle.png" width="25%" style="padding: 20 0 20 0;" /></p>
<pre class="typescript"><code>&lt;g&gt;
    &lt;Box width={width} height={height / 2} /&gt;
&lt;/g&gt;
&lt;g transform={`translate(0,${height / 2})`}&gt;
    &lt;Box width={width} height={height / 2} /&gt;
&lt;/g&gt;</code></pre>
<p>Note how the second box gets moved to the bottom by translating its container group by <code>height/2</code>.</p>
<p>To make things a bit more interesting, let’s make the circle alternate between boxes at a fixed interval:</p>
<p><img src="/images/boxes-jumping-circle.gif" width="25%" style="padding: 20 0 20 0;" /></p>
<pre class="typescript"><code>type State = {
    readonly box: 'UPPER' | 'LOWER';
};

class App extends React.Component&lt;object, State&gt; {

    private readonly circleId = 'circleId';
    private timer: Timer;

    constructor(props: object) {
        super(props);
        this.state = {box: 'UPPER'};
    }

    componentDidMount() {
        this.timer = setInterval(() =&gt; this.switchBox(), 1000);
    }

    switchBox() {
        this.setState(prevState =&gt; ({box: prevState.box === 'UPPER' ? 'LOWER' : 'UPPER'}));
    }

    render() {

        const viewBox = {width: 100, height: 100};
        const margin = {top: 10, right: 10, bottom: 10, left: 10};
        const width = viewBox.width - margin.left - margin.right;
        const height = viewBox.height - margin.top - margin.bottom;

        return (
            &lt;div className=&quot;App&quot;&gt;
                &lt;svg viewBox={`0 0 ${viewBox.width} ${viewBox.height}`}&gt;
                    &lt;g transform={`translate(${margin.left}, ${margin.top})`}&gt;
                        &lt;g&gt;
                            &lt;Box
                                circleId={this.circleId}
                                showCircle={this.state.box === 'UPPER'}
                                width={width}
                                height={height / 2}
                            /&gt;
                        &lt;/g&gt;
                        &lt;g transform={`translate(0,${height / 2})`}&gt;
                            &lt;Box
                                circleId={this.circleId}
                                showCircle={this.state.box === 'LOWER'}
                                width={width}
                                height={height / 2}
                            /&gt;
                        &lt;/g&gt;
                    &lt;/g&gt;
                &lt;/svg&gt;
            &lt;/div&gt;
        );
    }

    componentWillUnmount() {
        clearInterval(this.timer);
    }

}</code></pre>
<p><em>Complete code on <a href="https://github.com/netzwerg/react-animation-demo">GitHub</a></em></p>
<h2 id="smoothly-moving-circles">Smoothly Moving Circles</h2>
<p>Blinking UIs are almost never a good idea, so back to animations! Smoothly moving the circle between boxes looks way better:</p>
<p><img src="/images/boxes-animated-circle.gif" width="25%" style="padding: 20 0 20 0;" /></p>
<p>We already know how to animate a circle’s position with D3.js, so <strong>this should be simple, right</strong>?</p>
<p>Well… the circle’s y-coordinate in the upper box is <code>height/2</code>, and its coordinate in the lower box is <code>height/2</code>, too! So how are we supposed to animate between these identical states?!</p>
<p>I vividly remember my own confusion when I first encountered this problem in one of our research projects.</p>
<p>The complexity is caused by the fact that our components all use their own, 0-based coordinate system. But that’s exactly what made the components simple in the first place, so we don’t want to give this up!</p>
<h2 id="animations-across-component-boundaries">Animations Across Component Boundaries</h2>
<p>Situation recap:</p>
<p><strong>What we have</strong> (and want to keep): <em>Simple components with 0-based coordinate systems</em></p>
<p><strong>What we want</strong>: <em>Animations across component boundaries</em></p>
<p>There’s no easy fix, but we know that animations are simple as long as they are happening on a <strong>common coordinate system</strong>. Thus the idea is straightforward: We keep using 0-based components, but switch to a common coordinate system while performing an animation. One very suitable common coordinate system is the view port coordinate system of our SVG’s root node.</p>
<p>Here’s the rough recipe:</p>
<ul>
<li>Calculate the circle’s global coordinates (relative to the svg view port)</li>
<li>Create a dedicated clone of the circle to be used for the animation</li>
<li>Attach the clone to the SVG root element</li>
<li>Hide the original circle during the course of the animation (so only the clone is visible)</li>
<li><strong>Animate!</strong></li>
<li>Detach the clone once the animation is done</li>
<li>Un-hide the original circle at the final state</li>
</ul>
<p>And in code (remember, the complete project is on <a href="https://github.com/netzwerg/react-animation-demo">GitHub</a>):</p>
<pre class="typescript"><code>const circle = this.svgRoot.getElementById(this.circleId) as SVGCircleElement;

if (circle) {

    // (0) Calculate current coordinates relative to global view port
    const currentCoordinates = this.getCoordinates(this.svgRoot, circle);

    const previousCoordinates = this.coordinateCache || currentCoordinates;

    this.coordinateCache = currentCoordinates;

    const easingFunction = currentCoordinates.cy &gt; previousCoordinates.cy ? easeBounceOut : easeCubicInOut;

    // (1) This clone will be used for the animation
    const animatedCircle = circle.cloneNode(true) as SVGCircleElement;

    // (2) Attach to root element (animated x/y coordinates are in the system of the global view port)
    this.svgRoot.appendChild(animatedCircle);

    // (3) The DOM already contains the circle at the new position -&gt; hide it until the animation is over
    select(circle)
        .attr('visibility', 'hidden');

    // (4) The actual animation
    select(animatedCircle)
        .attr('visibility', 'visible')
        .attr('cx', previousCoordinates.cx)
        .attr('cy', previousCoordinates.cy)
        .transition()
        .duration(1000)
        .ease(easingFunction)
        .attr('cx', currentCoordinates.cx)
        .attr('cy', currentCoordinates.cy)
        .remove() // (5) Detach the animated circle once we're done
        .on('end', () =&gt; { // (6) Un-hide new state (already properly placed in the DOM)
            select(circle)
                .attr('visibility', 'visible');
        });

}</code></pre>
<p>Phew, some things are harder than they should be – let me know if there’s a simpler way!</p>

<hr />

<a class="index-footer" href="/archive.html">Older Posts &raquo; Archive</a>

</div>
<div class="container footer">
    <p>Written by Rahel Lüthy &mdash; Generated by <a href="https://jaspervdj.be/hakyll">Hakyll</a></p>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-708448-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>