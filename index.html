<html>
<head>

    <title>Above, Below, and Beyond Tech Talk</title>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="/favicon.png" rel="icon" />

    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/tomorrow-night-bright.css" />

    <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />
    <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />

    <link href="/css/style.css" rel="stylesheet" />
</head>
<body>
<div class="container header">
    <div class="jumbotron">
        <h1>Above, Below, and Beyond Tech Talk</h1>
        <p>by Rahel Lüthy</p>
    </div>
    <nav class="navbar navbar-default">
        <div>
            <ul class="nav navbar-nav">
                <li><a href="/">Blog</a></li>
                <li><a href="/archive.html">Archive</a></li>
                <li><a href="/about.html">About</a></li>
            </ul>
        </div>
    </nav>
</div>
<div class="container content">
    
<div class="info">
    May 13, 2015
</div>
<h1>Java 8 Unsigned Int</h1>
<p>When I recently profiled one of our applications, it turned out that a lot of memory was wasted on a huge number of <code>long</code> primitives. They were used to represent IDs, which were originating from a 3rd party text file. Someone must have loved huge numbers, so they chose an ID format that didn’t fit into an <code>int</code>.</p>
<p>Well, while being huge, the IDs were at least always positive. So I was confident that some data massage would allow me to squeeze them into primitive <code>int</code> values eventually. It took me be surprise that Java 8 actually supports unsigned primitives out of the box. Guess we all missed that while wrapping our heads around lambdas and streams, right?</p>
<p>Here’s how it works:</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> UnsignedIntTest {

    <span class="fu">@Test</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">roundTrip</span>() {

        <span class="co">// compile error: 2^32 - 1 is too large for an int</span>
        <span class="co">// int intValue = 4294967295;</span>

        <span class="dt">long</span> longValue = (<span class="dt">long</span>) Math.<span class="fu">pow</span>(<span class="dv">2</span>, <span class="dv">32</span>) - <span class="dv">1</span>;
        String longValueAsString = String.<span class="fu">valueOf</span>(longValue);

        <span class="dt">int</span> unsignedInt = Integer.<span class="fu">parseUnsignedInt</span>(longValueAsString);

        <span class="dt">long</span> result = Integer.<span class="fu">toUnsignedLong</span>(unsignedInt);

        <span class="fu">assertEquals</span>(longValue, result);

    }

}</code></pre></div>

<hr />

<div class="info">
    March 22, 2015
</div>
<h1>JavaFX 3D Line</h1>
<p>I have no experience in 3D programming whatsoever. Last week, I took my first steps in JavaFX 3D, but hit a wall when I wanted to draw a line between two points: There is no <code>Line</code> shape! The only out-of-the-box <code>Shape3D</code> classes are <code>Box</code>, <code>Cylinder</code>, <code>Sphere</code>, and <code>MeshView</code> – wow…</p>
<p>Well, it shouldn’t be too difficult to connect the points with a slender cylinder, right?</p>
<p>I was wrong, it took me an <em>embarrassingly</em> long time to get the trigonometry right :-)</p>
<p>Here’s my magic crutch:</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> Cylinder <span class="fu">createConnection</span>(Point3D origin, Point3D target) {
    Point3D yAxis = <span class="kw">new</span> <span class="fu">Point3D</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>);
    Point3D diff = target.<span class="fu">subtract</span>(origin);
    <span class="dt">double</span> height = diff.<span class="fu">magnitude</span>();

    Point3D mid = target.<span class="fu">midpoint</span>(origin);
    Translate moveToMidpoint = <span class="kw">new</span> <span class="fu">Translate</span>(mid.<span class="fu">getX</span>(), mid.<span class="fu">getY</span>(), mid.<span class="fu">getZ</span>());

    Point3D axisOfRotation = diff.<span class="fu">crossProduct</span>(yAxis);
    <span class="dt">double</span> angle = Math.<span class="fu">acos</span>(diff.<span class="fu">normalize</span>().<span class="fu">dotProduct</span>(yAxis));
    Rotate rotateAroundCenter = <span class="kw">new</span> <span class="fu">Rotate</span>(-Math.<span class="fu">toDegrees</span>(angle), axisOfRotation);

    Cylinder line = <span class="kw">new</span> <span class="fu">Cylinder</span>(<span class="dv">1</span>, height);

    line.<span class="fu">getTransforms</span>().<span class="fu">addAll</span>(moveToMidpoint, rotateAroundCenter);

    <span class="kw">return</span> line;
}</code></pre></div>
<p>To illustrate what’s going on, I created a 2D representation of all individual steps, starting off with the creation of the cylinder. By default, its center is placed at the origin:</p>
<p><img src="/images/cylinder-1.png" width="150px" /></p>
<p>The <code>moveToMidpoint</code> transformation moves its center to the final location (the yellow midpoint in the above image):</p>
<p><img src="/images/cylinder-2.png" width="150px" /></p>
<p>And finally, the <code>rotateAroundCenter</code> transformation corrects the cylinder’s direction:</p>
<p><img src="/images/cylinder-3.png" width="150px" /></p>
<p>Obviously, the tricky part is finding the proper axis and angle of rotation. Both are calculated relative to the <code>yAxis</code> because of the cylinder’s initial direction. The <code>axisOfRotation</code> must be perpendicular to the plane defined by the <code>yAxis</code> and the <code>diff</code> vector. To find such a perpendicular vector, we can (by definition) calculate the <a href="http://en.wikipedia.org/wiki/Cross_product">cross product</a> of the two vectors. In the 2D case, the result is equivalent to the z-axis, but in 3D it may be tilted.</p>
<p>The angle is calculated based on the <a href="http://en.wikipedia.org/wiki/Dot_product">dot product</a> (aka scalar product) of the two vectors, which is defined by</p>
<p><code>A • B = |A| |B| cos(alpha)</code></p>
<p>If <code>A</code> and <code>B</code> are both unit vectors, this becomes</p>
<p><code>A • B = cos(alpha)</code></p>
<p>which we can resolve to</p>
<p><code>alpha = acos(A • B)</code></p>
<p>That’s it!</p>

<hr />

<div class="info">
    February 27, 2015
</div>
<h1>Scala Gems #9: Regex Extractors</h1>
<p>Suppose you have a simple date string: <code>&quot;2015-02-27&quot;</code></p>
<p>Regular expressions allow to parse the date and extract parts thereof[^1]: <code>(\d\d\d\d)-(\d\d)-(\d\d)</code> defines a pattern which matches the digits and defines capturing groups for the year, month, and day parts.</p>
<p>In Java, a simple example usage would look like this:</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Pattern pattern = Pattern.<span class="fu">compile</span>(<span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d)-(</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d)-(</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d)&quot;</span>);
Matcher matcher = pattern.<span class="fu">matcher</span>(<span class="st">&quot;2015-02-27&quot;</span>);
<span class="kw">while</span> (matcher.<span class="fu">find</span>()) {
    System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Year: &quot;</span> + matcher.<span class="fu">group</span>(<span class="dv">1</span>));
    System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Month: &quot;</span> + matcher.<span class="fu">group</span>(<span class="dv">2</span>));
    System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Day: &quot;</span> + matcher.<span class="fu">group</span>(<span class="dv">3</span>));
}</code></pre></div>
<p>Accessing the groups by index is rather awkward and error prone. Luckily, Java 7 introduced support for named groups:</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Pattern pattern = Pattern.<span class="fu">compile</span>(<span class="st">&quot;(?&lt;year&gt;</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d)-(?&lt;month&gt;</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d)-(?&lt;day&gt;</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d)&quot;</span>);
Matcher matcher = pattern.<span class="fu">matcher</span>(<span class="st">&quot;2015-02-27&quot;</span>);
<span class="kw">while</span> (matcher.<span class="fu">find</span>()) {
    System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Year: &quot;</span> + matcher.<span class="fu">group</span>(<span class="st">&quot;year&quot;</span>));
    System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Month: &quot;</span> + matcher.<span class="fu">group</span>(<span class="st">&quot;month&quot;</span>));
    System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Day: &quot;</span> + matcher.<span class="fu">group</span>(<span class="st">&quot;day&quot;</span>));
}</code></pre></div>
<p>That’s better, but I personally don’t like how the group names pollute the pattern. Regular expressions are hard to read already, the Java escape characters add yet more clutter, and the additional <code>?&lt;group&gt;</code> constructs are a kiss of death.</p>
<p>Let’s look at how the same problem can be tackled in Scala:</p>
<p><a href="http://www.scala-lang.org/api/current/#scala.util.matching.Regex">According to the docs</a>, the canonical way to create a <code>Regex</code> is by using the method <code>r</code>, which is provided implicitly for strings:</p>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> Date = <span class="st">&quot;&quot;&quot;(\d\d\d\d)-(\d\d)-(\d\d)&quot;&quot;&quot;</span>.<span class="fu">r</span></code></pre></div>
<p>Note the triple quotes, which allow to use the backslashes without further escaping. While this is nice, the true advantage of Scala is that regular expressions can be used as extractors in a pattern match. The pattern stays plain and simple, and yet we have all the freedom to name groups as we please:</p>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="st">&quot;2015-02-27&quot;</span> <span class="kw">match</span> {
  <span class="kw">case</span> Date(year, month, day) =&gt;
    <span class="fu">println</span>(s<span class="st">&quot;Year: $year&quot;</span>)
    <span class="fu">println</span>(s<span class="st">&quot;Month: $month&quot;</span>)
    <span class="fu">println</span>(s<span class="st">&quot;Day: $day&quot;</span>)
}</code></pre></div>
<p>Look ma, no clutter! [^1]:Yes, using <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html">java.time.format.DateTimeFormatter</a> would be easier in this simple case.</p>

<hr />

<a class="index-footer" href="/archive.html">Older Posts &raquo; Archive</a>

</div>
<div class="container footer">
    <p>Written by Rahel Lüthy &mdash; Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a></p>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-708448-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>